<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Nesting is state - clipperhouse</title>
  
  <meta name="description" content="There are stylistic debates about how much nesting or indentation one should choose in code. This slide and the one that follows illustrate the issue well. The slide refers to â€œcognitive loadâ€ without explaining, and it occurs to me that nesting is state.
In the first example, if we want to debug around the highlighted line, what do we need to keep in mind? func (g *Gopher) WriteTo(w io.Writer) (size int64, err error) { err = binary.">
  <meta name="author" content="">
  
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i" rel="stylesheet">
  <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.ico">
  
  <meta name="generator" content="Hugo 0.40.3">
  
  <link rel="alternate" type="application/atom+xml" href="/index.xml" title="clipperhouse">
</head>
<body class="single">
  <header class="header">
    
    <p class="title"><a href="/"><span>ğŸ±</span>clipperhouse</a></p>
    
    <button class="menu-toggle" type="button"></button>
    <nav class="menu">
      <ul>
        
        
      </ul>
    </nav>
  </header>
  <main class="main">

<article class="post post-view">
  <header class="post-header">
    <h1 class="post-title">Nesting is state</h1>
    <p class="post-meta">2014.3.30</p>
  </header>
  <div class="post-content"><p>There are stylistic debates about how much nesting or indentation one should choose in code. <a href="http://talks.golang.org/2013/bestpractices.slide#3">This slide</a> and the <a href="http://talks.golang.org/2013/bestpractices.slide#4">one that follows</a> illustrate the issue well. The slide refers to â€œcognitive loadâ€ without explaining, and it occurs to me that <strong>nesting is state</strong>.</p>

<p>In the first example, if we want to debug around the highlighted line, what do we need to keep in mind?
<code>func (g *Gopher) WriteTo(w io.Writer) (size int64, err error) {  
    err = binary.Write(w, binary.LittleEndian, int32(len(g.Name)))  
    if err == nil {  
        size += 4  
        var n int  
        n, err = w.Write([]byte(g.Name))  
        size += int64(n)  
        if err == nil {  
            err = binary.Write(w, binary.LittleEndian, int64(g.AgeYears))  
            if err == nil {  
                size += 4  
            }  
            return  
        }  
        return  
    }  
    return  
}</code></p>

<p>Answer: <em>the truth of each of the if statements that precede it.</em> Each of those bits of truth is a piece of state. Now look at the alternative:
<code>func (g *Gopher) WriteTo(w io.Writer) (size int64, err error) {  
    err = binary.Write(w, binary.LittleEndian, int32(len(g.Name)))  
    if err != nil {  
        return  
    }  
    size += 4  
    n, err := w.Write([]byte(g.Name))  
    size += int64(n)  
    if err != nil {  
        return  
    }  
    err = binary.Write(w, binary.LittleEndian, int64(g.AgeYears))  
    if err == nil {  
        size += 4  
    }  
    return  
}</code></p>

<p>In this case, the highlighted line â€œcaresâ€ very little about what came beforeâ€Šâ€”â€Šall it needs to know is that we got there.</p>

<p>The flattening of the hierarchy plus lots of return-on-fail can be thought of as â€œsheddingâ€ state. I call this pattern â€œfail fastâ€: by the time you get to the bottom of the code, you really only need one piece of â€œstateâ€, which is â€œweâ€™ve gotten this far successfullyâ€. You can forget the past.</p>

<p>Of course, the logic of these two examples is equivalent. I am speaking of the mental modelâ€Šâ€”â€Šthe list of â€œnon-localâ€ things that must be kept in mind when working with a local piece of code.</p>

<p>And for me, â€œlist of non-local thingsâ€ is a good definition of â€œstateâ€.</p>

<p><a href="https://news.ycombinator.com/item?id=7497134"><em>discuss on hacker news</em></a></p>
</div>
  <footer class="post-footer">
    
  </footer>
  
  
  
  
</article>
</main>
<footer class="footer">
  <span>&copy; 2017-2018 clipperhouse ğŸ‰</span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" target="_blank">Hugoâ¤ï¸ï¸</a></span>
  <span>&middot;</span>
  <span>Designed by <a href="http://21beats.com/" target="_blank">ï¸21beatsâš¡ï¸</a></span>
</footer>
<script src="https://cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js" data-no-instant></script>
<script data-no-instant>
  hljs.initHighlightingOnLoad();
  menuToggle();
  InstantClick.on('change', function() {
    var blocks = document.querySelectorAll('pre code');
    for (var i = 0; i < blocks.length; i++) {
      hljs.highlightBlock(blocks[i]);
    }
    menuToggle();
  });
  function menuToggle() {
    var $toggle = document.querySelector('.menu-toggle');
    if (!$toggle.offsetParent) {
      return;
    }
    var $body = document.querySelector('body');
    $toggle.addEventListener('click', function() {
      $body.classList.toggle('noscroll');
    }, false);
  }
</script>
</body>
</html>

