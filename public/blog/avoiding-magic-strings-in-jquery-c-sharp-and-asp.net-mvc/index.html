<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Avoiding â€œmagic stringsâ€ in jQuery, C# and ASP.net MVC - clipperhouse</title>
  
  <meta name="description" content="The longer I program, the less tolerance I have for â€œmagic stringsâ€. You might be familiar with themâ€Šâ€”â€Šthey are strings that have programmatic meaning but are trapped between quotes in another language.
A classic example is SQL held in a string variable within your C#/PHP/whatever code. It might just as easily be HTML in your Javascript.
The problem is that this code is meaningless outside of its domain.">
  <meta name="author" content="">
  
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i" rel="stylesheet">
  <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.ico">
  
  <meta name="generator" content="Hugo 0.40.3">
  
  <link rel="alternate" type="application/atom+xml" href="/index.xml" title="clipperhouse">
</head>
<body class="single">
  <header class="header">
    
    <p class="title"><a href="/"><span>ğŸ±</span>clipperhouse</a></p>
    
    <button class="menu-toggle" type="button"></button>
    <nav class="menu">
      <ul>
        
        
      </ul>
    </nav>
  </header>
  <main class="main">

<article class="post post-view">
  <header class="post-header">
    <h1 class="post-title">Avoiding â€œmagic stringsâ€ in jQuery, C# and ASP.net MVC</h1>
    <p class="post-meta">2010.9.7</p>
  </header>
  <div class="post-content">

<p>The longer I program, the less tolerance I have for â€œmagic stringsâ€. You might be familiar with themâ€Šâ€”â€Šthey are strings that have programmatic meaning but are trapped between quotes in another language.</p>

<p>A classic example is SQL held in a string variable within your C#/PHP/whatever code. It might just as easily be HTML in your Javascript.</p>

<p>The problem is that this code is meaningless outside of its domain. Your SQL server knows what SELECT means, but the PHP interpreter does not. If you misspell it, or generate it dynamically, and it fails, you are not going to know why. Cross your fingers!</p>

<p>The problems are clear:</p>

<ul>
<li>Magic strings are error-prone</li>
<li>Your tools (compilers, interpreters, debuggers and IDEs) canâ€™t tell you if (or why) they are wrong</li>
<li>They are tedious, hard to read, and hard to maintainâ€Šâ€”â€Ši.e., a waste of a smart programmerâ€™s time</li>
</ul>

<p>Iâ€™ve learned a few ways of avoiding these problems. Most of the techniques come down to being disciplined about <a href="http://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a>.</p>

<h4 id="javascript-jquery-and-html">Javascript (jQuery) and HTML</h4>

<p>How many times have you seen something likeâ€¦
$(â€œbodyâ€).append(â€˜&lt;div class=â€highlightâ€ id=â€â€™ + newid + â€˜â€&gt;â€ + message + â€˜&lt;/div&gt;â€™);</p>

<p>That new div might or might not appear in the browser. See the syntax error? You might have to squint. And imagine, god forbid, that we need to nest an element inside that div.</p>

<p>Weâ€™re not adding a DOM element to the page, we are adding a magic string that might maybe be a tag.</p>

<p>How do we avoid this? One option is to have the DOM element already on the page (perhaps with display:none), and then just manipulate it with jQueryâ€Šâ€”â€Šthat would be ideal separation of concerns.</p>

<p>But if you must create the new element, jQuery allows us to do this with a minimum of stringy-ness:
var newdiv = $(â€œ&lt;div /&gt;â€).addClass(â€œhighlightâ€).attr(â€œidâ€, newid).html(message);<br />
$(â€œbodyâ€).append(newdiv);</p>

<p>That first bit creates a jQuery <em>object</em> that can accept the methods that follow. We avoid worrying about matching up the closing tags &amp; attribute quotes, counting apostrophesâ€Šâ€”â€Šand squinting.</p>

<h4 id="c-html-and-urls">C#, HTML and URLs</h4>

<p>There are places where you might want to dynamically create markup in your executable code. This leads us down the same road as above.</p>

<p>(Again, you would hope your HTML lives elsewhere, but-if-you-mustâ€¦)</p>

<p>C# has classes which can help here. The first is <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.tagbuilder_members.aspx">TagBuilder</a>, and it has a style similar to the jQuery thing above:
var img = new TagBuilder(â€œimgâ€);<br />
img.MergeAttribute(â€œsrcâ€, my_image_url, true);<br />
img.MergeAttribute(â€œaltâ€, my_image_desc);<br />
img.MergeAttributes(new RouteValueDictionary(htmlAttributes));</p>

<p>var a = new TagBuilder(â€œaâ€);<br />
a.MergeAttribute(â€œhrefâ€, my_url, true);<br />
a.InnerHtml = img.ToString(TagRenderMode.SelfClosing);</p>

<p>An img inside an anchor is clean and readable. There are a number of convenience bits in there (note the MergeAttributes and SelfClosing) that will save you tedium.</p>

<p>And you know what? URLâ€™s are magic strings too. How many times have you concatenated and replaced and parsed them? Ick. Check out <a href="http://msdn.microsoft.com/en-us/library/system.uribuilder_members.aspx">UriBuilder</a>. (URI is the proper term, btw.)</p>

<p>Want to switch from http to https?
var url = new UriBuilder(Request.Url);<br />
url.Scheme = Uri.UriSchemeHttps;</p>

<p>Then just call ToString() when you need the full URL as a string.</p>

<p>Want to find out the fully qualified host name, without parsing? Thatâ€™s simply the url.Host property. The querystring is .Query. You get it. Not a substring() or indexOf() in sight.</p>

<h4 id="asp-net-mvc">ASP.net MVC</h4>

<p>â€¦is wonderful, IMHO. But there can be a lot oâ€™ magic strings. This allows us to work fluidly, as if we are in a dynamic language. But, speaking for myself, I want to know when Iâ€™ve fat-fingered something before runtime.</p>

<p>There is a great third-party tool called <a href="http://mvccontrib.codeplex.com/wikipage?title=T4MVC">T4MVC</a> by the brilliant <a href="http://blogs.msdn.com/b/davidebb/">David Ebbo</a>. Long story short, it gives you strongly-typed helpers such as:
&lt;%= Html.ActionLink(â€œview my profileâ€, MVC.Profile.Detail(some_user_id)) %&gt;</p>

<p>â€¦andâ€¦
return Redirect(MVC.Account.Logon());</p>

<p>It helps with versioning your static CSS and JS files, too. (I bet you are using magic strings for that.)</p>

<p>And if you really want to go nuts, check out <a href="http://www.weirdlover.com/tag/chirpy/">Chirpy</a>, which automates T4MVC and a bunch more.</p>
</div>
  <footer class="post-footer">
    
  </footer>
  
  
  
  
</article>
</main>
<footer class="footer">
  <span>&copy; 2017-2018 clipperhouse ğŸ‰</span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" target="_blank">Hugoâ¤ï¸ï¸</a></span>
  <span>&middot;</span>
  <span>Designed by <a href="http://21beats.com/" target="_blank">ï¸21beatsâš¡ï¸</a></span>
</footer>
<script src="https://cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js" data-no-instant></script>
<script data-no-instant>
  hljs.initHighlightingOnLoad();
  menuToggle();
  InstantClick.on('change', function() {
    var blocks = document.querySelectorAll('pre code');
    for (var i = 0; i < blocks.length; i++) {
      hljs.highlightBlock(blocks[i]);
    }
    menuToggle();
  });
  function menuToggle() {
    var $toggle = document.querySelector('.menu-toggle');
    if (!$toggle.offsetParent) {
      return;
    }
    var $body = document.querySelector('body');
    $toggle.addEventListener('click', function() {
      $body.classList.toggle('noscroll');
    }, false);
  }
</script>
</body>
</html>

